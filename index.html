<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Office Move Countdown</title>
  <!-- Tailwind via CDN for styling -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- React and ReactDOM via CDN -->
  <script crossorigin src="https://unpkg.com/react@17/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js"></script>
  <!-- Babel for JSX support in the browser -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    .backface-hidden { backface-visibility: hidden; }
    .translate-z-10 { transform: translateZ(10px); }
  </style>
</head>
<body class="bg-stone-200">
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect, useMemo } = React;

    const TruckIcon = ({ size = 140, className = "", fill = "#57534e", stroke = "white", strokeWidth = 1 }) => (
      <svg
        width={size}
        height={(size * 3) / 4}
        viewBox="0 0 24 18"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
        className={className}
      >
        <rect x="1" y="7" width="12" height="6" rx="1" fill={fill} stroke={stroke} strokeWidth={strokeWidth} />
        <path d="M13 8H18.5L22 11.5V13H13V8Z" fill={fill} stroke={stroke} strokeWidth={strokeWidth} />
        <rect x="16.5" y="9" width="3.5" height="2.5" fill="#d6d3d1" />
        <circle cx="6" cy="14.5" r="2" fill="#1c1917" stroke={stroke} strokeWidth={strokeWidth} />
        <circle cx="17" cy="14.5" r="2" fill="#1c1917" stroke={stroke} strokeWidth={strokeWidth} />
      </svg>
    );

    const BuildingIcon = ({ size = 20, className = "", fill = "none", stroke = "currentColor", strokeWidth = 2 }) => (
      <svg
        width={size}
        height={size}
        viewBox="0 0 24 24"
        fill={fill}
        xmlns="http://www.w3.org/2000/svg"
        className={className}
      >
        <rect x="3" y="3" width="18" height="18" rx="2" stroke={stroke} strokeWidth={strokeWidth} />
        <path d="M9 3V21" stroke={stroke} strokeWidth={strokeWidth} />
        <path d="M15 3V21" stroke={stroke} strokeWidth={strokeWidth} />
        <path d="M3 9H21" stroke={stroke} strokeWidth={strokeWidth} />
        <path d="M3 15H21" stroke={stroke} strokeWidth={strokeWidth} />
      </svg>
    );

    const MapPinIcon = ({ size = 18, className = "", fill = "none", stroke = "currentColor", strokeWidth = 2 }) => (
      <svg
        width={size}
        height={size}
        viewBox="0 0 24 24"
        fill={fill}
        xmlns="http://www.w3.org/2000/svg"
        className={className}
      >
        <path d="M12 22s7-7.5 7-12a7 7 0 1 0-14 0c0 4.5 7 12 7 12Z" stroke={stroke} strokeWidth={strokeWidth} />
        <circle cx="12" cy="10" r="2.5" stroke={stroke} strokeWidth={strokeWidth} />
      </svg>
    );

    // リアルな段ボールのSVGコンポーネント
    const CardboardBox = ({ width = 60, height = 50, type = 0 }) => {
      const baseColor = "#d4a373";
      const shadowColor = "#bc8a5f";
      const tapeColor = "#e6ccb2";

      return (
        <svg width={width} height={height} viewBox="0 0 100 86" fill="none" xmlns="http://www.w3.org/2000/svg" style={{ overflow: 'visible' }}>
          <rect x="0" y="20" width="100" height="80" rx="2" fill={baseColor} stroke={shadowColor} strokeWidth="2" />
          <path d="M0 20 L15 0 L115 0 L100 20 Z" fill="#e9c496" stroke={shadowColor} strokeWidth="2" />
          <path d="M100 20 L115 0 L115 80 L100 100 Z" fill={shadowColor} opacity="0.6" />
          {type === 0 && (
            <>
              <rect x="45" y="20" width="10" height="80" fill={tapeColor} opacity="0.8" />
              <path d="M50 0 L55 20 L65 20 L60 0 Z" fill={tapeColor} opacity="0.6" />
            </>
          )}
          {type === 1 && (
            <>
              <rect x="0" y="50" width="100" height="10" fill={tapeColor} opacity="0.8" />
              <rect x="45" y="20" width="10" height="80" fill={tapeColor} opacity="0.8" />
              <path d="M50 0 L55 20 L65 20 L60 0 Z" fill={tapeColor} opacity="0.6" />
            </>
          )}
          {type === 2 && (
            <>
               <rect x="10" y="30" width="20" height="30" fill="#ef4444" opacity="0.8" rx="2" />
               <path d="M15 40 L25 50 M25 40 L15 50" stroke="white" strokeWidth="3" />
               <rect x="70" y="20" width="10" height="80" fill={tapeColor} opacity="0.8" />
               <path d="M75 0 L80 20 L90 20 L85 0 Z" fill={tapeColor} opacity="0.6" />
            </>
          )}
        </svg>
      );
    };

    // 足の生えた歩く段ボールキャラクター
    const WalkingBoxCharacter = () => (
      <svg width="40" height="50" viewBox="0 0 40 50" fill="none" xmlns="http://www.w3.org/2000/svg" className="overflow-visible">
        <g className="animate-[walk_1s_infinite_ease-in-out] origin-top" style={{ transformBox: 'fill-box' }}>
          <path d="M15 35 L12 48" stroke="#8c7851" strokeWidth="3" strokeLinecap="round" />
          <path d="M25 35 L28 48" stroke="#8c7851" strokeWidth="3" strokeLinecap="round" className="animate-[walk_1s_infinite_ease-in-out_reverse]"/>
        </g>
        <rect x="5" y="5" width="30" height="30" rx="2" fill="#d4a373" stroke="#bc8a5f" strokeWidth="2" />
        <circle cx="15" cy="18" r="2" fill="#5c4033" />
        <circle cx="25" cy="18" r="2" fill="#5c4033" />
        <path d="M38 10 Q40 12 38 14" stroke="#60a5fa" strokeWidth="1.5" fill="none" opacity="0.6" />
      </svg>
    );

    const OfficeMoveCountdown = () => {
      const [remainingDays, setRemainingDays] = useState(null);
      const [targetDateStr, setTargetDateStr] = useState("");
      const [currentDateStr, setCurrentDateStr] = useState("");
      const [startAnimation, setStartAnimation] = useState(false);
      const [boxCount, setBoxCount] = useState(0);
      const [progressRatio, setProgressRatio] = useState(0);

      const getTargetDate = () => {
        const now = new Date();
        const currentYear = now.getFullYear();
        let target = new Date(currentYear, 1, 28);
        if (now > target) {
          target = new Date(currentYear + 1, 1, 28);
        }
        return target;
      };

      const holidays = [
        "2026-02-11",
        "2026-02-23",
      ];

      useEffect(() => {
        const calculateBusinessDays = () => {
          const start = new Date();
          start.setHours(0, 0, 0, 0);

          const target = getTargetDate();
          target.setHours(0, 0, 0, 0);

          setTargetDateStr(target.toLocaleDateString('ja-JP', { year: 'numeric', month: '2-digit', day: '2-digit' }).replace(/\//g, '.'));
          setCurrentDateStr(start.toLocaleDateString('ja-JP', { year: 'numeric', month: 'long', day: 'numeric', weekday: 'short' }));

          if (start > target) {
            setRemainingDays(0);
            setBoxCount(30);
            setProgressRatio(1);
            return;
          }

          let count = 0;
          let current = new Date(start);

          while (current < target) {
            const dayOfWeek = current.getDay();
            const year = current.getFullYear();
            const month = String(current.getMonth() + 1).padStart(2, '0');
            const day = String(current.getDate()).padStart(2, '0');
            const dateString = `${year}-${month}-${day}`;
            const isWeekend = dayOfWeek === 0 || dayOfWeek === 6;
            const isHoliday = holidays.includes(dateString);

            if (!isWeekend && !isHoliday) {
              count++;
            }
            current.setDate(current.getDate() + 1);
          }
          setRemainingDays(count);

          const maxDaysScale = 45;
          const progress = Math.max(0, Math.min(1, (maxDaysScale - count) / maxDaysScale));
          setProgressRatio(progress);

          const maxBoxes = 40;
          setBoxCount(Math.max(5, Math.floor(progress * maxBoxes)));
        };

        calculateBusinessDays();

        const timer = setTimeout(() => {
          setStartAnimation(true);
        }, 600);

        return () => clearTimeout(timer);
      }, []);

      const boxes = useMemo(() => {
        return Array.from({ length: 50 }).map((_, i) => ({
          id: i,
          left: `${(i * 19) % 90 + 2}%`,
          bottom: `${(Math.floor(i / 6) * 35) + (i % 3) * 10 - 10}px`,
          zIndex: 50 - i,
          rotation: `${(i % 7 - 3) * 3}deg`,
          type: i % 3,
          scale: 0.9 + (i % 4) * 0.1,
          width: 60 + (i % 5) * 10,
        }));
      }, []);

      const coverLayers = Array.from({ length: 15 });

      return (
        <div className="min-h-screen bg-stone-200 flex flex-col items-center justify-center p-4 font-sans text-stone-800 overflow-hidden relative">
          <style>{`
            @keyframes walk {
              0%, 100% { transform: rotate(-15deg); }
              50% { transform: rotate(15deg); }
            }
          `}</style>

          <div className="absolute inset-0 opacity-10 pointer-events-none"
               style={{ backgroundImage: 'radial-gradient(#a8a29e 1px, transparent 1px)', backgroundSize: '20px 20px' }}>
          </div>

          <div className="absolute bottom-0 w-full h-80 pointer-events-none z-0 px-4 opacity-50">
            {boxes.slice(0, boxCount).map((box) => (
              <div
                key={box.id}
                className="absolute transition-all duration-1000 ease-out drop-shadow-sm grayscale-[0.3]"
                style={{
                  left: box.left,
                  bottom: box.bottom,
                  transform: `rotate(${box.rotation}) scale(${box.scale})`,
                  opacity: startAnimation ? 1 : 0,
                  transformOrigin: 'bottom center',
                  zIndex: box.zIndex
                }}
              >
                <CardboardBox width={box.width} type={box.type} />
              </div>
            ))}
          </div>

          <div className={`absolute bottom-8 left-0 w-full max-w-lg px-8 z-30 transition-opacity duration-1000 ${startAnimation ? 'opacity-100' : 'opacity-0'}`}
               style={{ left: '50%', transform: 'translateX(-50%)' }}>

            <div className="relative w-full h-px border-t-2 border-dashed border-stone-400 mt-8 mb-2 flex items-center justify-between">
              <div className="absolute -top-6 -left-2 flex flex-col items-center">
                <BuildingIcon size={20} className="text-stone-500 mb-1" />
                <span className="text-[10px] font-bold text-stone-500 bg-stone-200 px-1 rounded">OLD</span>
              </div>
              <div className="absolute -top-6 -right-2 flex flex-col items-center">
                <BuildingIcon size={24} className="text-blue-600 mb-1 drop-shadow-sm" fill="#dbeafe" stroke="#2563eb" />
                <span className="text-[10px] font-bold text-blue-600 bg-blue-50 px-1 rounded">NEW</span>
              </div>

              <div
                className="absolute -top-10 transition-all duration-[2000ms] ease-out"
                style={{
                  left: `calc(${progressRatio * 100}% - 20px)`,
                }}
              >
                <div className="absolute -top-8 left-1/2 -translate-x-1/2 whitespace-nowrap bg-white px-2 py-1 rounded-lg text-[10px] font-bold shadow-sm border border-stone-200 text-stone-600 after:content-[''] after:absolute after:top-full after:left-1/2 after:-translate-x-1/2 after:border-4 after:border-transparent after:border-t-white">
                   {progressRatio < 0.1 ? "Start!" : progressRatio > 0.9 ? "Almost!" : `${Math.floor(progressRatio * 100)}%`}
                </div>
                <WalkingBoxCharacter />
              </div>
            </div>

            <div className="flex items-center justify-center gap-2 text-[10px] text-stone-500 mt-2">
              <MapPinIcon size={14} className="text-stone-500" />
              <span>移転ルート進行中</span>
            </div>
          </div>

          <div className="relative w-full max-w-[320px] z-20 mb-20" style={{ perspective: '1500px' }}>
            <div className="bg-white rounded-t-xl rounded-b-md shadow-2xl border border-stone-300 relative overflow-visible">
              <div className="absolute -top-4 left-0 w-full flex justify-between px-10 z-[100]">
                 {[0, 1].map((i) => (
                   <div key={i} className="w-4 h-10 bg-gradient-to-b from-stone-300 to-stone-400 rounded-full shadow-lg border border-stone-400 flex items-center justify-center">
                     <div className="w-3 h-8 bg-stone-100 rounded-full shadow-inner"></div>
                   </div>
                 ))}
              </div>

              {coverLayers.map((_, index) => {
                const isTop = index === 0;
                const zIndex = 50 - index;
                const delay = index * 0.06;

                return (
                  <div
                    key={index}
                    className="absolute inset-0 bg-stone-800 flex flex-col items-center justify-center text-white border-b-4 border-stone-600 rounded-t-xl origin-top backface-hidden"
                    style={{
                      zIndex: zIndex,
                      transformStyle: 'preserve-3d',
                      transition: `transform 0.6s cubic-bezier(0.3, 1, 0.7, 1) ${delay}s, opacity 0.3s ease-in ${delay + 0.3}s`,
                      transform: startAnimation ? 'rotateX(160deg) translateY(40px) scale(0.95)' : 'rotateX(0deg)',
                      opacity: startAnimation ? 0 : 1,
                      pointerEvents: startAnimation ? 'none' : 'auto',
                    }}
                  >
                     {isTop ? (
                        <div className="text-center transform translate-z-10">
                          <p className="text-stone-400 text-sm font-bold tracking-widest uppercase mb-2">TODAY</p>
                          <p className="text-4xl font-bold">{currentDateStr.split('月')[0]}月</p>
                          <p className="text-6xl font-black">{currentDateStr.match(/(\d+)日/)?.[1]}</p>
                          <p className="mt-8 text-xs text-stone-500 animate-pulse">Loading...</p>
                        </div>
                     ) : (
                        <div className="w-full h-full bg-stone-700 border-t border-stone-600"></div>
                     )}
                  </div>
                );
              })}

              <div className="p-8 pb-10 text-center min-h-[420px] flex flex-col items-center justify-between bg-white rounded-t-xl rounded-b-md">
                <div className="w-full border-b-2 border-dashed border-stone-200 mt-6 mb-4"></div>

                <div>
                  <span className="inline-block px-3 py-1 bg-red-600 text-white text-[10px] font-bold tracking-widest uppercase rounded-sm mb-2 shadow-sm">
                    Office Relocation
                  </span>
                  <h2 className="text-stone-400 text-xs font-bold tracking-wider">
                    オフィス移転まで残り
                  </h2>
                </div>

                <div className="relative py-2">
                  <span className="text-[9rem] leading-none font-black text-stone-800 tracking-tighter drop-shadow-md">
                    {remainingDays}
                  </span>
                  <span className="absolute bottom-6 -right-2 text-xl font-bold text-red-600 bg-white px-2 py-1 transform -rotate-6 border border-red-100 shadow-md rounded-sm">
                    Days
                  </span>
                </div>

                <div className="space-y-4 w-full">
                  <div className="flex items-center justify-center gap-2 text-stone-500 bg-stone-50 py-3 rounded-lg border border-stone-100 shadow-inner">
                     <p className="text-[10px] font-bold uppercase tracking-wider">Target Date</p>
                     <p className="text-base font-bold text-stone-700">{targetDateStr}</p>
                  </div>

                  <div className="text-[10px] text-stone-400 flex justify-center items-center gap-1">
                    <span className="w-2 h-2 rounded-full bg-red-500"></span>
                    <span>土日祝を除く稼働日のみ</span>
                  </div>
                </div>

              </div>
            </div>

            <div
              className="absolute top-full left-4 right-4 h-6 bg-black rounded-[100%] blur-xl transition-all duration-1000 delay-500"
              style={{
                opacity: startAnimation ? 0.2 : 0,
                transform: startAnimation ? 'scale(1)' : 'scale(0.5)'
              }}
            ></div>
          </div>

          {remainingDays !== null && remainingDays <= 5 && (
            <div className={`absolute right-2 bottom-6 z-40 transition-transform duration-1000 ${startAnimation ? 'translate-x-0' : 'translate-x-full'}`}>
              <TruckIcon size={140} className="text-stone-700 drop-shadow-2xl" fill="#57534e" stroke="white" strokeWidth={1} />
            </div>
          )}

          <div className="absolute top-4 right-4 text-stone-400 text-[10px] z-0">
             ver 5.0 Walking Box
          </div>
        </div>
      );
    };

    ReactDOM.render(<OfficeMoveCountdown />, document.getElementById('root'));
  </script>
</body>
</html>
